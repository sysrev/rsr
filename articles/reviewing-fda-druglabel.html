<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Using rsr to create a Drugs@FDA review of cardiotoxicity documents. Analyze the metadata, automate labelling, do some analysis of cardiotoxicity FDA reviews.
">
<title>Reviewing Drugs@FDA • rsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reviewing Drugs@FDA">
<meta property="og:description" content="Using rsr to create a Drugs@FDA review of cardiotoxicity documents. Analyze the metadata, automate labelling, do some analysis of cardiotoxicity FDA reviews.
">
<meta property="og:image" content="https://r.sysrev.com/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rsr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1.9006</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/rsr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/reviewing-fda-druglabel.html">Reviewing Drugs@FDA</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sysrev/rsr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="reviewing-fda-druglabel_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Reviewing Drugs@FDA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sysrev/rsr/blob/HEAD/vignettes/reviewing-fda-druglabel.Rmd" class="external-link"><code>vignettes/reviewing-fda-druglabel.Rmd</code></a></small>
      <div class="d-none name"><code>reviewing-fda-druglabel.Rmd</code></div>
    </div>

    
    
<p>Sysrev provides a <a href="mailto:Drugs@FDA" class="email">Drugs@FDA</a> searchable stream for document reviews which politely ingests PDFs and metadata from <a href="https://labels.fda.gov/" class="external-link">labels.fda.gov</a>.</p>
<p>The docs/metadata are indexed with a PDF parsing / OCR function to enable full text search and categorization. Sysrev also creates a versioning system for FDA documents by evaluating FDA application numbers and types.</p>
<p>In this vignette, you will learn to:<br><strong>Search</strong> <a href="mailto:Drugs@FDA" class="email">Drugs@FDA</a> –&gt; <strong>Review</strong> drug labels –&gt; <strong>Analyze</strong> results.</p>
<p><img src="../../../../../thomas/git/co.insilica/rsr/articles/reviewing-fda-druglabel_files/figure-gfm/unnamed-chunk-1-1.png" width="100%"></p>
<div class="section level2">
<h2 id="cardiotoxfda-sysrev">Cardiotox@FDA sysrev<a class="anchor" aria-label="anchor" href="#cardiotoxfda-sysrev"></a>
</h2>
<p>We are going to create a living review of FDA drug labels called <a href="https://sysrev.com/p/111474" class="external-link">Cardiotox@FDA</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/create_sysrev.html">create_sysrev</a></span><span class="op">(</span><span class="st">"Cardiotox@FDA"</span>,get_if_exists<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="../reference/browse_.html">browse_sysrev</a></span><span class="op">(</span>pid<span class="op">=</span><span class="fl">111474</span><span class="op">)</span> <span class="op">}</span></code></pre></div>
<p>An FDA Sysrev source is created at <a href="https://sysrev.com/p/111474/add-articles" class="external-link">sysrev.com/p/111474/add-articles</a> by selecting FDA docs of application type new drug application <strong><code>NDA</code></strong> document type <strong><code>Review</code></strong> and text matching <strong><code>cardiotoxicity</code></strong>. Learn more about FDA applications types at <a href="https://www.fda.gov/drugs/how-drugs-are-developed-and-approved/types-applications" class="external-link">FDA How Drugs Are Developed.</a></p>
<p><img src="../../../../../thomas/git/co.insilica/rsr/articles/figures/cardiotox-source.png" title="Creating a Drugs\@FDA source" alt="Creating a Drugs\@FDA source" width="100%"></p>
<p>The search results in 112 articles, a manageable size for a vignette. <code>Import</code> pushes the labels into the Cardiotox@FDA sysrev. We can inspect the data source, add notes, and set it to automatically add new articles that match our query by clicking “check new results” at the cardiotox@fda <a href="https://sysrev.com/p/111474/add-articles" class="external-link">sources page</a> (below screenshot).</p>
<p><img src="../../../../../thomas/git/co.insilica/rsr/articles/figures/cardiotox-source-living.png" title="Clicking **check for new results** makes a living review" alt="Clicking **check for new results** makes a living review" width="100%"></p>
<p>Anytime the FDA adds a new drug application review document with “cardiotoxicity” in the text it will be added to this review. Why might this be useful?</p>
</div>
<div class="section level2">
<h2 id="analyzing-fda-metadata">Analyzing FDA Metadata<a class="anchor" aria-label="anchor" href="#analyzing-fda-metadata"></a>
</h2>
<p>After importing our source we can start analyzing the documents. <code>rsr::get_article_content(111474)</code> retrieves the article content (including meta-data) for every imported FDA drug document. The below code associates the sysrev article_id (called aid) with druglabel review type, sponsor, products data, and submission data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meta.tb</span> <span class="op">=</span> <span class="fu">rsr</span><span class="fu">::</span><span class="fu"><a href="../reference/get_.html">get_article_content</a></span><span class="op">(</span><span class="fl">111474</span><span class="op">)</span>              |&gt; <span class="co"># get article content</span>
  <span class="fu">mutate</span><span class="op">(</span>path     <span class="op">=</span> <span class="fu">glue</span><span class="op">(</span><span class="st">'~/tmp/rsr/pdf/{aid}.pdf'</span><span class="op">)</span><span class="op">)</span>    |&gt; <span class="co"># local file names</span>
  <span class="fu">mutate</span><span class="op">(</span>metadata <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">metadata</span>,<span class="fu">jsonlite</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/jsonlite/man/read_json.html" class="external-link">parse_json</a></span><span class="op">)</span><span class="op">)</span> |&gt; <span class="co"># parse FDA meta</span>
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span>                                |&gt; <span class="co"># FDA meta to cols</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">aid</span>,                             
         fda.id     <span class="op">=</span> <span class="va">ApplNo</span>,             <span class="co"># FDA Application Number</span>
         sponsor    <span class="op">=</span> <span class="va">SponsorName</span>,        <span class="co"># Sponsor of reviewed product </span>
         review     <span class="op">=</span> <span class="va">ReviewDocumentType</span>, <span class="co"># review type medical, pharma, ...</span>
         product    <span class="op">=</span> <span class="va">Products</span>,           <span class="co"># nested list w/ product data</span>
         submission <span class="op">=</span> <span class="va">Submissions</span>,        <span class="co"># nested list w/ submission data</span>
         url        <span class="op">=</span> <span class="va">contentUrl</span>,         <span class="co"># a url for the included pdf</span>
         <span class="va">path</span><span class="op">)</span>                            <span class="co"># a local path to store pdfs</span>
<span class="va">meta.tb</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="op">]</span></code></pre></div>
<pre><code><span class="co">## # A tibble: 2 × 8</span>
<span class="co">##        aid fda.id sponsor             review   product  submission url     path </span>
<span class="co">##      &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;               &lt;chr&gt;    &lt;list&gt;   &lt;list&gt;     &lt;chr&gt;   &lt;glu&gt;</span>
<span class="co">## 1 13913155 207561 GILEAD SCIENCES INC medical… &lt;list [… &lt;list [18… https:… ~/tm…</span>
<span class="co">## 2 13913084 209360 LA JOLLA PHARMA     risk as… &lt;list [… &lt;list [1]&gt; https:… ~/tm…</span></code></pre>
<p>Sometimes a document contains multiple submissions and products. These complex subfields can have many rows and a few columns. In the below code, we extract the active ingredient from <code>product</code>, and review priority / submission type from <code>submission</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prod.tb</span> <span class="op">=</span> <span class="va">meta.tb</span> |&gt; <span class="fu">select</span><span class="op">(</span><span class="va">aid</span>,<span class="va">product</span><span class="op">)</span>          |&gt; <span class="co"># build aid -&gt; products</span>
  <span class="fu">unnest_longer</span><span class="op">(</span><span class="va">product</span><span class="op">)</span> |&gt; <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">product</span><span class="op">)</span> |&gt; <span class="co"># list to columns</span>
  <span class="fu">separate_rows</span><span class="op">(</span><span class="va">ActiveIngredient</span>,sep<span class="op">=</span><span class="st">"; "</span><span class="op">)</span>        |&gt; <span class="co"># "name; name" -&gt; 2 rows</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">aid</span>, prod.active <span class="op">=</span> <span class="va">ActiveIngredient</span><span class="op">)</span>
<span class="va">sub.tb</span> <span class="op">=</span> <span class="va">meta.tb</span> |&gt; <span class="fu">select</span><span class="op">(</span><span class="va">aid</span>,<span class="va">submission</span><span class="op">)</span>               |&gt; <span class="co"># aid -&gt; submission</span>
  <span class="fu">unnest_longer</span><span class="op">(</span><span class="va">submission</span><span class="op">)</span> |&gt; <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">submission</span><span class="op">)</span>  |&gt; <span class="co"># list to columns</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">aid</span>,
         sub.priority <span class="op">=</span> <span class="va">ReviewPriority</span>,
         sub.subtype  <span class="op">=</span> <span class="va">SubmissionType</span><span class="op">)</span></code></pre></div>
<p>Joining the meta, products and submission tables on sysrev article_id (aid) gives us a basic analyis table <code>fda.tb</code>. Note that article ids are repeated for documents with multiple products/submissions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fda.tb</span> <span class="op">=</span> <span class="va">meta.tb</span> |&gt; 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">prod.tb</span>,by<span class="op">=</span><span class="st">"aid"</span><span class="op">)</span> |&gt; <span class="fu">left_join</span><span class="op">(</span><span class="va">sub.tb</span>, by<span class="op">=</span><span class="st">"aid"</span><span class="op">)</span> |&gt;
  <span class="fu">select</span><span class="op">(</span><span class="va">aid</span>, <span class="va">sponsor</span>, <span class="va">review</span>, <span class="va">sub.priority</span>, <span class="va">sub.subtype</span>, <span class="va">prod.active</span><span class="op">)</span> |&gt;
  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span>
<span class="va">fda.tb</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="op">]</span></code></pre></div>
<pre><code><span class="co">## # A tibble: 2 × 6</span>
<span class="co">##        aid sponsor             review       sub.priority sub.subtype prod.active</span>
<span class="co">##      &lt;int&gt; &lt;chr&gt;               &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;      </span>
<span class="co">## 1 13913155 GILEAD SCIENCES INC medical rev… STANDARD     ORIG        COBICISTAT </span>
<span class="co">## 2 13913155 GILEAD SCIENCES INC medical rev… STANDARD     SUPPL       COBICISTAT</span></code></pre>
<div class="section level3">
<h3 id="meta-categories">Meta categories<a class="anchor" aria-label="anchor" href="#meta-categories"></a>
</h3>
<p>The <a href="https://alastairrushworth.github.io/inspectdf/reference/inspect_cat.html" class="external-link">inspectDF</a> provides a quick way to analyze these the fda.tb.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">icat</span> <span class="op">&lt;-</span> <span class="fu">inspectdf</span><span class="fu">::</span><span class="fu"><a href="https://alastairrushworth.github.io/inspectdf/reference/inspect_cat.html" class="external-link">inspect_cat</a></span><span class="op">(</span><span class="va">fda.tb</span><span class="op">)</span>
<span class="va">icat</span> |&gt; <span class="fu">inspectdf</span><span class="fu">::</span><span class="fu"><a href="https://alastairrushworth.github.io/inspectdf/reference/show_plot.html" class="external-link">show_plot</a></span><span class="op">(</span>label_color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
<p><img src="../../../../../thomas/git/co.insilica/rsr/articles/reviewing-fda-druglabel_files/figure-gfm/inspect_meta_categories-1.png" width="100%"></p>
<p>This table shows that gilead sciences has the most imported documents ( x products x submissions ). There are quite a few active ingredients, the top 5 by distinct(aid) are: COBICISTAT, SOFOSBUVIR, ELVITEGRAVIR, EMTRICITABINE, NALOXONE HYDROCHLORIDE</p>
<p>How many of those are Gilead active ingredients?</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fda.tb</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sponsor</span><span class="op">==</span><span class="st">"GILEAD SCIENCES INC"</span><span class="op">)</span>          |&gt; <span class="co"># GET GSI docs</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">prod.active</span>,priority<span class="op">=</span><span class="va">sub.priority</span><span class="op">==</span><span class="st">"PRIORITY"</span><span class="op">)</span>    |&gt; <span class="co"># get count by priority</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">prod.active</span>,<span class="va">n</span><span class="op">)</span>,y<span class="op">=</span><span class="va">n</span>,fill<span class="op">=</span><span class="va">priority</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># make a plot</span>
  <span class="fu">geom_col</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span> <span class="co"># + ...</span></code></pre></div>
<p><img src="../../../../../thomas/git/co.insilica/rsr/articles/reviewing-fda-druglabel_files/figure-gfm/gilead_priority_drug_graph-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="manually-label">Manually Label<a class="anchor" aria-label="anchor" href="#manually-label"></a>
</h2>
<p>Sadly, most information in FDA docs is not metadata. More can be learned by reading, and extracting data from the docs. We could identify sentences that contain information like:<br><strong>1. phenotypes</strong>: Where is cardiotoxicity referenced? What other phenotypes are there?<br><strong>2. dose</strong>: What doses are evaluated?<br><strong>3. route</strong>: How is a compound/substance delivered?</p>
<p>On the cardiotox@FDA labels page <a href="https://sysrev.com/u/139/p/111474/labels/edit" class="external-link">sysrev.com/p/111474/labels/edit</a> we create a simple label for including articles and identifying cardiotoxicity sentences. We’ve labeled just a few articles so far. The answers can be extracted with <code><a href="../reference/get_answers.html">rsr::get_answers</a></code>. Other vignettes provide much more detail on the labelling process.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rsr</span><span class="fu">::</span><span class="fu"><a href="../reference/get_answers.html">get_answers</a></span><span class="op">(</span><span class="fl">111474</span><span class="op">)</span> |&gt; 
  <span class="fu">select</span><span class="op">(</span><span class="va">aid</span>,<span class="va">user_id</span>,<span class="va">confirm_time</span>,<span class="va">short_label</span>,<span class="va">value_type</span>,<span class="va">answer</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## # A tibble: 4 × 6</span>
<span class="co">##        aid user_id confirm_time        short_label        value_type answer     </span>
<span class="co">##      &lt;int&gt;   &lt;int&gt; &lt;chr&gt;               &lt;chr&gt;              &lt;chr&gt;      &lt;chr&gt;      </span>
<span class="co">## 1 13913147     139 2022-01-16 19:44:29 cardiotox sentence annotation "{\"34afa2…</span>
<span class="co">## 2 13913147     139 2022-01-16 19:44:29 Include            boolean    "true"     </span>
<span class="co">## 3 13913153     139 2022-01-18 14:21:48 cardiotox sentence annotation "{\"a7de64…</span>
<span class="co">## 4 13913153     139 2022-01-18 14:21:48 Include            boolean    "true"</span></code></pre>
<p>Annotating pdfs is laborious. Can we do it faster?</p>
</div>
<div class="section level2">
<h2 id="automated-labels">Automated Labels<a class="anchor" aria-label="anchor" href="#automated-labels"></a>
</h2>
<p>Sysrev services provide functions that can automate document review tasks like data sourcing, extraction, review and analysis. There are two services avaiable for this project:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rsr</span><span class="fu">::</span><span class="fu"><a href="../reference/service_list.html">service_list</a></span><span class="op">(</span><span class="fl">111474</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## # A tibble: 2 × 4</span>
<span class="co">##   service        status description             reference                       </span>
<span class="co">##   &lt;chr&gt;          &lt;chr&gt;  &lt;chr&gt;                   &lt;chr&gt;                           </span>
<span class="co">## 1 en_tox         active NER for toxicology      https://github.com/ontox-hu/... </span>
<span class="co">## 2 export_answers active export answers to excel https://github.com/sysrev/servi…</span></code></pre>
<p>Services are still in development, but the EN_TOX tool, developed by Marc Teunis and Marie Corradi for the <a href="https://ontox-project.eu/" title="European Union ONTOX project" class="external-link">EU ONTOX project</a> can automate some of the manual labelling tasks we described above. The service takes text and returns named toxicological entities. Below demonstrates how you could run this service on text from 5 imported FDA documents.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">possible_text</span> <span class="op">=</span> <span class="fu">pdftools</span><span class="fu">::</span><span class="va">pdf_text</span> |&gt; <span class="fu">possibly</span><span class="op">(</span>other <span class="op">=</span> <span class="cn">NA_character_</span><span class="op">)</span>
<span class="va">en_tox</span>        <span class="op">=</span> <span class="fu">partial</span><span class="op">(</span><span class="va">service_run</span>,pid<span class="op">=</span><span class="fl">111474</span>,service<span class="op">=</span><span class="st">"en_tox"</span><span class="op">)</span> |&gt;  <span class="fu">possibly</span><span class="op">(</span>o <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co"># pdf_text works pretty well</span>
<span class="va">text</span> <span class="op">=</span> <span class="fu">pdftools</span><span class="fu">::</span><span class="fu">pdf_text</span><span class="op">(</span><span class="va">meta.tb</span><span class="op">$</span><span class="va">path</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">text</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">text</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">text</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">text</span><span class="op">[</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span>
<span class="va">entity.fda</span> <span class="op">=</span> <span class="va">meta.tb</span> |&gt; <span class="fu">select</span><span class="op">(</span><span class="va">aid</span>,<span class="va">path</span><span class="op">)</span> |&gt; <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>            |&gt; <span class="co"># demo on 5 paths </span>
  <span class="fu">mutate</span><span class="op">(</span>text     <span class="op">=</span> <span class="fu">pblapply</span><span class="op">(</span><span class="va">path</span>,<span class="va">possible_text</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu">unnest</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> |&gt; <span class="co"># pdf to text</span>
  <span class="fu">mutate</span><span class="op">(</span>text     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pat <span class="op">=</span><span class="st">" +"</span>,repl <span class="op">=</span> <span class="st">" "</span>, <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>     |&gt; <span class="co"># clean text</span>
  <span class="fu">mutate</span><span class="op">(</span>entities <span class="op">=</span> <span class="fu">pblapply</span><span class="op">(</span><span class="va">text</span>,<span class="va">en_tox</span><span class="op">)</span><span class="op">)</span>                        |&gt; <span class="co"># run en_tox</span>
  <span class="fu">unnest</span><span class="op">(</span><span class="va">entities</span><span class="op">)</span>                                                |&gt; <span class="co"># extract result</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">aid</span>,<span class="va">entity</span>,<span class="va">value</span>,<span class="va">context</span><span class="op">)</span> </code></pre></div>
<p>The en_tox on all pdfs is precomputed and loaded below. In a final high level analysis, entity values are counted across all the imported FDA documents. <code><a href="https://rdrr.io/pkg/textstem/man/lemmatize_strings.html" class="external-link">textstem::lemmatize_strings</a></code> lemmatizes the values to help with the disambiguation process (i.e. human -&gt; human or humans, cell -&gt; cell or cells, etc.). Real disambiguation is a much bigger task.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">entity.fda</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"vignettes/data/entity.fda.RDS"</span><span class="op">)</span><span class="op">)</span> <span class="co"># get cached en_tox results </span>
<span class="va">clean_text</span> <span class="op">=</span> <span class="fu">compose</span><span class="op">(</span><span class="va">tolower</span>,<span class="fu">textstem</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/textstem/man/lemmatize_strings.html" class="external-link">lemmatize_strings</a></span><span class="op">)</span>   <span class="co"># clean entity values</span>
<span class="va">entity.count</span> <span class="op">=</span> <span class="va">entity.fda</span>                       |&gt; <span class="co"># lets count tox entities! </span>
  <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu">clean_text</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  |&gt; <span class="co"># factors let us use forcats</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">aid</span>,<span class="va">entity</span>,<span class="va">value</span><span class="op">)</span> |&gt; <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span>        |&gt; <span class="co"># count entity + value articles</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">entity</span><span class="op">)</span>                              |&gt; <span class="co"># top 10 values by entity type</span>
  <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_lump.html" class="external-link">fct_lump_n</a></span><span class="op">(</span><span class="va">value</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="co"># call non top 10 values 'Other'</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>                                     |&gt; 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">entity</span>,<span class="va">value</span><span class="op">)</span>                        |&gt; 
  <span class="fu">summarize</span><span class="op">(</span>docs <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">aid</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="../../../../../thomas/git/co.insilica/rsr/articles/reviewing-fda-druglabel_files/figure-gfm/unnamed-chunk-10-1.png" title="number of cardiotoxicity drugs@fda documents by entity value identified by the EN_TOX ner model" alt="number of cardiotoxicity drugs@fda documents by entity value identified by the EN_TOX ner model" width="100%"></p>
<p>In this vignette we demonstrated integration of the <a href="mailto:Drugs@FDA" class="email">Drugs@FDA</a> resource into sysrev reviews. Sysrev services and rsr_methods were introduced:<br><strong>1.<code><a href="../reference/create_sysrev.html">rsr::create_sysrev</a></code></strong>: Create a sysrev with your sysrev token.<br><strong>2.<code><a href="../reference/get_.html">rsr::get_article_content</a></code></strong>: Get metadata and content urls from sysrev project ids.<br><strong>3.<code><a href="../reference/get_answers.html">rsr::get_answers</a></code></strong>: Get metadata and content urls from sysrev project ids.<br><strong>4.<code><a href="../reference/service_run.html">rsr::service_run</a></code></strong>: Get a function reference to run a sysrev service.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://sysrev.com/user/139/profile" class="external-link">Thomas Luechtefeld</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
